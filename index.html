<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Field Goal Chaos - Streak Master</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { margin:0; background:#1a1a1a; font-family:Arial Black; color:white; display:flex; justify-content:center; align-items:center; height:100vh; overflow: hidden; }
canvas { border:4px solid white; border-radius:14px; background:#333; touch-action: none; cursor: crosshair; }
.overlay { position:absolute; inset:0; background:rgba(0,0,0,0.9); display:none; flex-direction:column; justify-content:center; align-items:center; text-align:center; z-index: 10; }
button { padding:12px 20px; margin:6px; font-size:16px; border-radius:8px; border:none; cursor:pointer; background: #fff; color: #000; font-weight: bold; transition: 0.2s; }
button:hover { background: #FFD700; transform: scale(1.05); }
.shop-container { width: 300px; max-height: 400px; overflow-y: auto; margin-bottom: 20px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 10px; }
.shop button { width:100%; text-align: left; margin: 4px 0; }
#hud { position:absolute; top:10px; width:340px; display:flex; flex-wrap: wrap; justify-content:space-between; font-size:14px; z-index: 5; pointer-events: none; text-shadow: 2px 2px 0px #000; }
#multDisplay { color: #FFD700; font-size: 18px; width: 100%; text-align: center; margin-top: 5px; transition: 0.3s; }
</style>
</head>
<body>

<div id="hud">
  <div>Score: <span id="hudScoreVal">0</span></div>
  <div>Dist: <span id="hudDistVal">10</span>y</div>
  <div>Cash: $<span id="hudCashVal">0</span></div>
  <div id="multDisplay">Multiplier: 1x</div>
</div>

<canvas id="c" width="360" height="640"></canvas>

<div class="overlay" id="gameOver">
  <h1 style="color:#ff4444">STREAK BROKEN</h1>
  <div id="finalStats" style="margin-bottom: 20px;"></div>
  <button onclick="restart()">Try Again</button>
  <button onclick="openShop()">Trail Shop</button>
</div>

<div class="overlay shop" id="shop">
  <h2 style="color:#FFD700">ðŸŽ¨ TRAIL SHOP</h2>
  <div class="shop-container" id="shopList"></div>
  <button onclick="closeShop()" style="background:#ff4444; color:white;">Back</button>
</div>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

// --- DATA ---
let cash = Number(localStorage.getItem("cash")) || 0;
let unlocked = JSON.parse(localStorage.getItem("trails")) || ["default"];
let equipped = localStorage.getItem("equipped") || "default";

let score = 0;
let kicking = false;
let gameOver = false;
let distanceCount = 0; 
let streak = 1; 
const FIXED_START_Y = 600; 
let ball = { x: 180, y: FIXED_START_Y, vx: 0, vy: 0 };
let goalX = 180;
let zones = [];
let particles = [];

const trails = [
  {id:"spark", name:"Spark", cost:500, color:"#ffd740"},
  {id:"smoke", name:"Smoke", cost:1000, color:"#999"},
  {id:"light", name:"Light", cost:1500, color:"#fff"},
  {id:"water", name:"Water", cost:2500, color:"#03a9f4"},
  {id:"fire", name:"Fire", cost:3500, color:"#ff5722"},
  {id:"slime", name:"Slime", cost:5000, color:"#32cd32"},
  {id:"magic", name:"Magic Pink", cost:7500, color:"#ff00ff"},
  {id:"matrix", name:"Matrix", cost:10000, color:"#00ff41"},
  {id:"blood", name:"Crimson", cost:15000, color:"#8b0000"},
  {id:"gold", name:"Pure Gold", cost:25000, color:"#ffd700"},
  {id:"void", name:"Void", cost:50000, color:"#1a1a1a"},
  {id:"galaxy", name:"Galaxy", cost:100000, color:"#483d8b"}
];

function spawnBall(madeKick = false) {
  if (madeKick) distanceCount++; 
  ball.x = 180;
  ball.y = FIXED_START_Y;
  ball.vx = 0;
  ball.vy = 0;
  kicking = false;
  // c: color, type: 'green', 'yellow', or 'grey'
  zones = [
    {pts:3, c:"#4caf50", type:"green"}, 
    {pts:2, c:"#ffeb3b", type:"yellow"}, 
    {pts:1, c:"#aaa", type:"grey"}
  ].sort(() => Math.random() - 0.5);
  goalX = 100 + Math.random() * 160;
  updateHUD();
}

function drawTrail() {
  if (equipped === "default") return;
  const t = trails.find(tr => tr.id === equipped);
  if (t) particles.push({ x: ball.x, y: ball.y, r: 10, life: 25, c: t.color });
}

function draw() {
  ctx.clearRect(0, 0, 360, 640);

  let visualScale = Math.max(0.15, 1.0 - (distanceCount * 0.05));
  let baseWidth = 180 * visualScale;
  let baseHeight = 120 * visualScale;
  let horizonY = 120 + (1 - visualScale) * 200; 

  ctx.fillStyle = "#555";
  ctx.fillRect(goalX - (8 * visualScale), horizonY + baseHeight, 16 * visualScale, 50 * visualScale);
  ctx.strokeStyle = "#FFD700"; 
  ctx.lineWidth = 10 * visualScale;
  ctx.lineCap = "round";
  ctx.beginPath(); 
  ctx.moveTo(goalX - baseWidth/2, horizonY + baseHeight);
  ctx.lineTo(goalX + baseWidth/2, horizonY + baseHeight);
  ctx.stroke();
  ctx.beginPath();
  ctx.moveTo(goalX - baseWidth/2, horizonY + baseHeight);
  ctx.lineTo(goalX - baseWidth/2, horizonY - (30 * visualScale));
  ctx.stroke();
  ctx.beginPath();
  ctx.moveTo(goalX + baseWidth/2, horizonY + baseHeight);
  ctx.lineTo(goalX + baseWidth/2, horizonY - (30 * visualScale));
  ctx.stroke();

  let zW = baseWidth / 3;
  zones.forEach((z, i) => {
    ctx.fillStyle = z.c;
    ctx.globalAlpha = 0.5;
    ctx.fillRect(goalX - baseWidth/2 + i*zW, horizonY, zW, baseHeight);
    ctx.globalAlpha = 1.0;
  });

  particles.forEach(p => {
    ctx.globalAlpha = p.life / 25;
    ctx.fillStyle = p.c;
    ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2); ctx.fill();
    p.life--; p.r *= 0.96;
  });
  particles = particles.filter(p => p.life > 0);
  ctx.globalAlpha = 1;

  ctx.fillStyle = "#6d4c41";
  ctx.beginPath();
  ctx.ellipse(ball.x, ball.y, 14, 22, 0, 0, Math.PI * 2);
  ctx.fill();
  ctx.strokeStyle = "white"; ctx.lineWidth = 1; ctx.stroke();

  if (kicking && !gameOver) {
    ball.x += ball.vx;
    ball.y += ball.vy;
    ball.vy += 0.35; 
    drawTrail();

    if (ball.y < horizonY + baseHeight && ball.y > horizonY - 10 && 
        ball.x > goalX - baseWidth/2 && ball.x < goalX + baseWidth/2) {
      let idx = Math.floor((ball.x - (goalX - baseWidth/2)) / zW);
      let hitZone = zones[idx];
      
      // MULTIPLIER LOGIC: January 2026 update
      if(hitZone.type === "green") {
          if(streak < 6) streak++;
      } else if(hitZone.type === "grey") {
          streak = 1; 
      }
      // If yellow, streak remains exactly what it was.

      score += hitZone.pts; 
      cash += (hitZone.pts * 50) * streak;
      localStorage.setItem("cash", cash);
      spawnBall(true);
    }
    if (ball.y < -50 || ball.x < -20 || ball.x > 380) {
        streak = 1; 
        spawnBall(false);
    }
    if (ball.y > 660) endGame();
  }
  requestAnimationFrame(draw);
}

// --- INPUTS ---
canvas.onpointerdown = e => { 
    const rect = canvas.getBoundingClientRect();
    canvas.startY = e.clientY - rect.top; 
    canvas.startX = e.clientX - rect.left; 
};
canvas.onpointerup = e => {
  if (kicking || gameOver) return;
  const rect = canvas.getBoundingClientRect();
  let dx = (e.clientX - rect.left) - canvas.startX;
  let dy = (e.clientY - rect.top) - canvas.startY;
  if (dy < -15) { 
    ball.vx = dx * 0.075; 
    ball.vy = dy * 0.095; 
    kicking = true; 
  }
};

function updateHUD() {
  document.getElementById("hudScoreVal").innerText = score;
  document.getElementById("hudCashVal").innerText = cash;
  document.getElementById("hudDistVal").innerText = 10 + (distanceCount * 3);
  let multEl = document.getElementById("multDisplay");
  multEl.innerText = `Multiplier: ${streak}x`;
  multEl.style.color = streak === 6 ? "#00ff41" : "#FFD700";
  multEl.style.transform = streak > 1 ? `scale(${1 + streak*0.05})` : "scale(1)";
}

function endGame() {
  gameOver = true;
  streak = 1; 
  document.getElementById("finalStats").innerHTML = `Score: ${score}<br>Dist reached: ${10 + (distanceCount * 3)} Yards<br>Total Cash: $${cash}`;
  document.getElementById("gameOver").style.display = "flex";
}

function restart() {
  score = 0; distanceCount = 0; streak = 1; gameOver = false;
  document.getElementById("gameOver").style.display = "none";
  spawnBall(false);
}

function openShop(){
  document.getElementById("gameOver").style.display="none";
  document.getElementById("shop").style.display="flex";
  const list = document.getElementById("shopList");
  list.innerHTML="";
  trails.forEach(t=>{
    const owned = unlocked.includes(t.id);
    const btn = document.createElement("button");
    btn.innerHTML = owned ? (equipped===t.id?`<b>${t.name} (Active)</b>`:`Use ${t.name}`) : `${t.name} - $${t.cost}`;
    btn.style.borderLeft = `12px solid ${t.color}`;
    if(!owned && cash < t.cost) btn.style.opacity = "0.5";
    btn.onclick = () => {
      if(owned){ equipped=t.id; localStorage.setItem("equipped", equipped); } 
      else if(cash>=t.cost){ 
        cash -= t.cost; unlocked.push(t.id); 
        localStorage.setItem("cash", cash); 
        localStorage.setItem("trails", JSON.stringify(unlocked)); 
        equipped=t.id; localStorage.setItem("equipped", equipped);
      }
      openShop(); updateHUD();
    };
    list.appendChild(btn);
  });
}
function closeShop(){ 
    document.getElementById("shop").style.display="none"; 
    document.getElementById("gameOver").style.display="flex"; 
}

spawnBall(false);
draw();
</script>
</body>
</html>
